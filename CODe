#include <DHT.h>

#define SOIL_PIN A0
#define RELAY_PIN 7
#define DHT_PIN 2
#define DHT_TYPE DHT11  // Change to DHT22 if using that sensor

DHT dht(DHT_PIN, DHT_TYPE);

int soilValue = 0;
int moisturePercent = 0;
int dryThreshold = 40;  // Below 40% → motor ON

void setup() {
  Serial.begin(9600);
  dht.begin();

  pinMode(RELAY_PIN, OUTPUT);
  digitalWrite(RELAY_PIN, HIGH);  // Relay OFF (active LOW)
}

void loop() {
  // Read soil moisture (0–1023)
  soilValue = analogRead(SOIL_PIN);

  // Convert to percentage (approx.)
  moisturePercent = map(soilValue, 1023, 0, 0, 100);

  // Read temperature and humidity
  float humidity = dht.readHumidity();
  float temp = dht.readTemperature();

  // Print data
  Serial.print("Soil Moisture: ");
  Serial.print(moisturePercent);
  Serial.println("%");

  Serial.print("Temp: ");
  Serial.print(temp);
  Serial.print(" C | Humidity: ");
  Serial.print(humidity);
  Serial.println("%");

  // Irrigation Logic
  if (moisturePercent < dryThreshold) {
    Serial.println("Soil Dry → Pump ON");
    digitalWrite(RELAY_PIN, LOW);  // Turn ON pump
  } else {
    Serial.println("Soil Moist Enough → Pump OFF");
    digitalWrite(RELAY_PIN, HIGH);  // Turn OFF pump
  }

  delay(2000);
}
